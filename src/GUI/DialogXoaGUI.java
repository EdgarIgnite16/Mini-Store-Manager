package GUI;

import BUS._DataValidator;
import BUS._MessageDialogHelper;
import BUS._SaveData;
import DTO.MatHangDTO;

import javax.swing.event.DocumentEvent;
import javax.swing.event.DocumentListener;

public class DialogXoaGUI extends javax.swing.JDialog {
    private MatHangDTO matHangDTO;
    private String key;

    /**
     * Creates new form SoLuongXoaDialogGUI
     */
    public DialogXoaGUI(java.awt.Frame parent, boolean modal, MatHangDTO item, String key) {
        super(parent, modal);
        initComponents();
        this.matHangDTO = item;
        this.key = key;
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">
    private void initComponents() {

        pnMain = new javax.swing.JPanel();
        lbSoLuong = new javax.swing.JLabel();
        txtSoLuong = new javax.swing.JTextField();
        btnXacNhan = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        setTitle("Nhập số lượng xoá");

        pnMain.setBorder(javax.swing.BorderFactory.createTitledBorder(javax.swing.BorderFactory.createTitledBorder(""), "Nhập số lượng cần xoá", javax.swing.border.TitledBorder.DEFAULT_JUSTIFICATION, javax.swing.border.TitledBorder.DEFAULT_POSITION, new java.awt.Font("Segoe UI", 0, 13))); // NOI18N

        lbSoLuong.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        lbSoLuong.setText("Số lượng:");

        txtSoLuong.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        txtSoLuong.getDocument().addDocumentListener(new DocumentListener() {
            @Override
            public void insertUpdate(DocumentEvent e) {
                txtSoLuongChangeUpdate(e);
            }

            @Override
            public void removeUpdate(DocumentEvent e) {
                txtSoLuongChangeUpdate(e);
            }

            @Override
            public void changedUpdate(DocumentEvent e) {
                txtSoLuongChangeUpdate(e);
            }
        });

        btnXacNhan.setFont(new java.awt.Font("Segoe UI", 0, 13)); // NOI18N
        btnXacNhan.setText("Xác nhận");
        btnXacNhan.setEnabled(false);
        btnXacNhan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btnXacNhanActionPerformed(evt);
            }
        });

        javax.swing.GroupLayout pnMainLayout = new javax.swing.GroupLayout(pnMain);
        pnMain.setLayout(pnMainLayout);
        pnMainLayout.setHorizontalGroup(
                pnMainLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(pnMainLayout.createSequentialGroup()
                                .addGap(12, 12, 12)
                                .addComponent(lbSoLuong)
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.UNRELATED)
                                .addComponent(txtSoLuong, javax.swing.GroupLayout.PREFERRED_SIZE, 176, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE))
                        .addGroup(javax.swing.GroupLayout.Alignment.TRAILING, pnMainLayout.createSequentialGroup()
                                .addContainerGap(javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addComponent(btnXacNhan, javax.swing.GroupLayout.PREFERRED_SIZE, 102, javax.swing.GroupLayout.PREFERRED_SIZE)
                                .addContainerGap())
        );
        pnMainLayout.setVerticalGroup(
                pnMainLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(pnMainLayout.createSequentialGroup()
                                .addGap(16, 16, 16)
                                .addGroup(pnMainLayout.createParallelGroup(javax.swing.GroupLayout.Alignment.BASELINE)
                                        .addComponent(lbSoLuong)
                                        .addComponent(txtSoLuong, javax.swing.GroupLayout.PREFERRED_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.PREFERRED_SIZE))
                                .addPreferredGap(javax.swing.LayoutStyle.ComponentPlacement.RELATED, 15, Short.MAX_VALUE)
                                .addComponent(btnXacNhan)
                                .addContainerGap())
        );

        javax.swing.GroupLayout layout = new javax.swing.GroupLayout(getContentPane());
        getContentPane().setLayout(layout);
        layout.setHorizontalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addContainerGap()
                                .addComponent(pnMain, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addContainerGap())
        );
        layout.setVerticalGroup(
                layout.createParallelGroup(javax.swing.GroupLayout.Alignment.LEADING)
                        .addGroup(layout.createSequentialGroup()
                                .addComponent(pnMain, javax.swing.GroupLayout.DEFAULT_SIZE, javax.swing.GroupLayout.DEFAULT_SIZE, Short.MAX_VALUE)
                                .addContainerGap())
        );

        pack();
        setLocationRelativeTo(null);
    }// </editor-fold>

    // xử lí nút xác nhận
    private void btnXacNhanActionPerformed(java.awt.event.ActionEvent evt) {
        StringBuilder sb = new StringBuilder();

        _DataValidator.validateIsNumberAndInteger(txtSoLuong, sb, "Đối số truyền vào phải là số dương");

        if(sb.length() > 0 ) {
            _MessageDialogHelper.showErrorDialog(this, String.valueOf(sb), "Vui lòng kiểm tra lại");
        } else {
            try {
                // trường hợp xoá là hoá đơn
                if (key.equals("HD")) {
                    if (Integer.parseInt(txtSoLuong.getText()) > matHangDTO.soLuong_hientai) {
                        _MessageDialogHelper.showErrorDialog(this, "Số lượng xoá không được phép lớn hơn số lượng sản phẩm trong giỏ hàng!",
                                "Kiểm tra số lượng xoá");
                        txtSoLuong.setText("");
                        txtSoLuong.requestFocus();
                    } else if (Integer.parseInt(txtSoLuong.getText()) == matHangDTO.soLuong_hientai) {
                        _MessageDialogHelper.showErrorDialog(this, "Phải có ít nhất 1 sản phẩm trong giỏ hàng!",
                                "Kiểm tra số lượng xoá");
                        txtSoLuong.setText("");
                        txtSoLuong.requestFocus();
                    } else {
                        _SaveData.soLuongXoa = Integer.parseInt(txtSoLuong.getText());
                        this.dispose();
                    }
                }

                // trường hợp xoá là phiếu nhập
                if (key.equals("PN")) {
                    if (Integer.parseInt(txtSoLuong.getText()) == matHangDTO.soLuong_hientai) {
                        _MessageDialogHelper.showErrorDialog(this, "Phải có ít nhất 1 sản phẩm!",
                                "Kiểm tra số lượng xoá");
                        txtSoLuong.setText("");
                        txtSoLuong.requestFocus();
                    } else {
                        _SaveData.soLuongXoa = Integer.parseInt(txtSoLuong.getText());
                        this.dispose();
                    }
                }
            } catch (Exception ex) {
                // Bắt exception trong thẻ input
                _MessageDialogHelper.showErrorDialog(this, "Vui lòng nhập chữ số!", "Lỗi đầu vào");
            }
        }
    }

    // xử lí txt số lượng
    private void txtSoLuongChangeUpdate(DocumentEvent e) {
        btnXacNhan.setEnabled(!txtSoLuong.getText().isEmpty());
    }

    // Variables declaration - do not modify
    private javax.swing.JButton btnXacNhan;
    private javax.swing.JLabel lbSoLuong;
    private javax.swing.JPanel pnMain;
    private javax.swing.JTextField txtSoLuong;
    // End of variables declaration
}
